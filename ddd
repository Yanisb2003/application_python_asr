---
- name: Playbook to build image and push to dockerhub
  hosts: aws_node
  become: true

  tasks:

  - name: stop running docker-compose
    command: docker-compose -f /app_repo/docker-compose.yml down
    ignore_errors: yes

  # - name: delete the container
  #   command: docker rm web-app
  #   ignore_errors: yes

  # - name: delete the image
  #   command: docker rmi yanishub1/iweb-app:latest
  #   ignore_errors: yes

  # - name: pull image from dockerhub
  #   command: docker pull yanishub1/iweb-app:latest

  - name: run docker-compose
    command: docker-compose -f /app_repo/docker-compose.yml up

  - name: Delete app repository
    file:
      path: "/opt/docker/app_repo"
      state: absent
